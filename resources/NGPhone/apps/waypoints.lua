WaypointPage = "main"

WayPointLocs = {
	['Jobs'] = { 
		-- Los Santos
		{ "LS - Criminal 1", 1625.92, -1508.65, 13.6 },
		{ "LS - Criminal 2", 2141.75, -1733.94, 17.28 },
		{ "LS - Criminal *", 2143.14, -1583.53, 14.35 },
		{ "LS - Mechanic", 2276.12, -2359.67, 13.55 },
		{ "LS - Pilot", 2003.13, -2294.49, 13.55 },
		{ "LS - Police", 1576.59, -1634.24, 13.56 },
		{ "LS - Medic", 1177.88, -1329.2, 14.08 },
		{ "LS - Fisher", 2158.27, -98.15, 2.81 },
		{ "LS - Detective", 1559.69, -1690.48, 5.89 },
		{ "LS - Stunter", 1948.64, -1364.5, 18.58 },
		{""},
		{ "LV - Criminal 1", 2460.31, 1324.94, 10.82 },
		{ "LV - Criminal 2", 1042.26, 2154.03, 10.82 },
		{ "LV - Criminal 3", 2124.29, 889.1, 11.18 },
		{ "LV - Criminal *", 2216.16, 2711.91, 10.82 },
		{ "LV - Mechanic", 1658.34, 2199.65, 10.82 },
		{ "LV - Pilot", 1651.48, 1614.14, 10.82 },
		{ "LV - Police", 2297.12, 2463.87, 10.82 },
		{ "LV - Medic", 1615.18, 1819.67, 10.83 },
		{ "LV - Detective", 2297.12, 2455.66, 10.82 },
		{""},
		{ "SF - Criminal 1", -1832.49, 584.03, 35.16 },
		{ "SF - Criminal 2", -2530.02, -624.22, 132.75 },
		{ "SF - Mechanic", -1710.16, 403.56, 7.42 },
		{ "SF - Pilot", -1253.7, 16.99, 14.15 },
		{ "SF - Police", -1614.66, 682.42, 7.19 },
		{ "SF - Detective", -1573.45, 653.08, 7.19 },
	},
	
	
	['Locations'] = { 
		-- Los Santos
		['Los Santos'] = {
			-- { "Name", x, y, z }
			{ "Ammunation", 1367.63, -1279.82, 14.55 },
			{ "Bank", 915.22, -1003.64, 39 },
			{ "Gym", 2229.52, -1721.75, 13.57 },
			{ "Saint General Hospital", 1177.26, -1324.92, 14.06 },
			{ "County General Hospital", 2029.25, -1419.17, 16.99 },
			{ "Crippen Memorial Hospital", 1371.24, 406.06, 19.76 },
			{ "Lottery", 1072.6, -1385.51, 13.88 },
			{ "Aircraft Modshop", 1928.92, -2294.31, 13.55 },
			{ "Transfender Modshop", 1041.46, -1016.23, 32.11 },
			{ "Lowrider Modshop", 2645.03, -2044.31, 13.64 },
			{ "Car Wash 1", 1911.2724609375, -1776.3037109375, 13.3828125 },
			{ "Car Wash 2", 2454.3271484375, -1461.1748046875, 24 },
			{ "Pay n' Spray 1", 1024.84, -1023.4, 32.1 },
			{ "Pay n' Spray 2", 2064.78, -1831.55, 13.55 },
			{ "Pay n' Spray 3", 487.41, -1741.73, 11.13 },
			{ "Pay n' Spray 4", 157.49, -22.02, 1.58 },
			{ "Aircraft Pay n' Spray", 1921.63, -2243.18, 13.55 },
			{ "Skin Shop 1", 2244.48, -1664.79, 16.48 },
			{ "Skin Shop 2", 1457.73, -1137.21, 24.97 },
			{ "User Shop 1", 1520.00, -1674.4, 13.50 },
			{ "User Shop 2", 2176.97, -1761.03, 13.55 },
			{ "User Shop 3", 1236.33, 211.6, 19.55 },
			{ "User Shop 4", 2335.43, -19.79, 26.48 },
			{ "Used Vehicle Shop 1", 1984.82, -1994.24, 13.55 },
			{ "Used Vehicle Shop 2", -82.1, -1602.55, 2.62 },
			{ "Ghetto Vehicle Shop", 2131.65, -1145.95, 24.64 },
			{ "Industrial Vehicle Shop", -81.18, -20.34, 3.12 },
			{ "Sports Vehicle Shop", 555.88, -1284.99, 17.25 },
			{ "Aircraft Vehicle Shop", 1999.1, -2359.93, 13.55 },
			{ "Bikes Vehicle Shop", 1808.63, -1908.01, 13.57 },
		},
		['Las Venturas'] = {
			{ "Ammunation", 2159.45, 943.09, 11.82 },
			{ "Bank", 2474.67, 1024.08, 11.82 },
			{ "Gym", 1968.9, 2295.32, 16.46 },
			{ "Las Venturas Hospital", 1607.06, 1825.09, 10.82 },
			{ "Medical Clinic", 2546.67, 1971.37, 10.82 },
			{ "Fort Carson Medical Center", -320.21, 1055.96, 20 },
			{ "Aircraft Modshop", 1329.75, 1487.58, 10.82 },
			{ "Aircraft Modshop", 356.63, 2540.61, 16.71 },
			{ "Transfender Modshop", 2386.67, 1052.13, 10.82 },
			{ "Car Wash 1", 2163.0654296875, 2472.8994140625, 10.8203125 },
			{ "Car Wash 2", 2147.728515625, 2713.7431640625, 10.8203125 },
			{ "Pay n' Spray 1", 1976.65, 2162.53, 11.07 },
			{ "Pay n' Spray 2", -99.77, 1120.9, 19.74 },
			{ "Aircraft Pay n' Spray 1", 1333.63, 1584.72, 10.82 },
			{ "Aircraft Pay n' Spray 2", 384.31, 2538.77, 16.54 },
			{ "User Shop 1", 2000.94, 1246.31, 10.81 },
			{ "User Shop 2", 1487.71, 2215.84, 11.02 },
			{ "User Shop 3", -154.09, 1181.54, 19.74 },
			{ "Used Vehicle Shop 1", 2211.84, 1515.69, 10.82 },
			{ "Used Vehicle Shop 2", -33.92, 1171.19, 19.42 },
			{ "Ghetto Vehicle Shop", 1946.58, 2068.86, 10.82 },
			{ "Industrial Vehicle Shop", 588.75, 1229.85, 11.72 },
			{ "Sports Vehicle Shop", 2200.41, 1392.29, 10.82 },
			{ "Aircraft Vehicle Shop", 1317.31, 1627.21, 10.82 },
		},
		['San Fierro'] = {
			{ "Bank", -1704.39, 785.8, 26.42 },
			{ "Gym", -2270.28, -155.99, 35.32 },
			{ "San Fierro Medical Center", -2644.37, 633.05, 14.45 },
			{ "Angel Pine Medical Center", -2201.14, -2292.66, 30.63 },
			{ "El Quebrados Medical Center", -1514.47, 2527.25, 55.74 },
			{ "Aircraft Modshop", -1297.07, -240.16, 14.14 },
			{ "Transfender Modshop", -1936.64, 246.25, 34.46 },
			{ "Wheel Arch Angels Modshop", -2723.11, 217.24, 4.48 },
			{ "Lowrider Modshop", -1787.24, 1215.26, 25.13 },
			{ "Pay n' Spray 1", -1904.95, 283.94, 41.05 },
			{ "Pay n' Spray 2", -2425.24, 1022.06, 50.4 },
			{ "Aircraft Pay n' Spray", -1349.63, -234.77, 14.15 },
			{ "User Shop 1", -1675.47, 1319.94, 7.19 },
			{ "User Shop 2", -2677.69, -278.85, 7.17 },
			{ "User Shop 3", -1089.54, -1655.38, 76.37 },
			{ "Used Vehicle Shop 1", -2233.13, 299.29, 35.12 },
			{ "Used Vehicle Shop 2", -2238.09, -2305.26, 30.52 },
			{ "Ghetto Vehicle Shop", -1656.12, 1218.02, 7.25 },
			{ "Industrial Vehicle Shop", -1893.15, -1665.19, 23.02 },
			{ "Sports Vehicle Shop", -1958.02, 302.34, 35.47 },
			{ "Aircraft Vehicle Shop", -1238.96, 20.22, 14.15 },
		},
	},
	
	['Players'] = { },
	['Custom'] = { },
}

function appFunctions.waypoints:onPanelLoad ( )
	WaypointPage = "main"
	guiGridListClear ( pages['waypoints'].grid  )
	WayPointLocs.Custom = { }
	WayPointLocs.Players = { }
	
	for i, v in pairs ( WayPointLocs ) do
		local r = guiGridListAddRow ( pages['waypoints'].grid  )
		guiGridListSetItemText ( pages['waypoints'].grid , r, 1, tostring ( i ), false, false )
	end
	
	local waypns = fromJSON ( getSetting ( "user_waypoints" ) );
	if ( type ( waypns ) == "table" ) then 
		for i,v in pairs ( waypns ) do 
			table.insert(WayPointLocs.Custom,v);
			--outputDebugString(string.format("Loading waypoint '%s' (%s, %s, %s)",unpack(v)))
		end 
	end 
	
	for _, p in pairs ( getElementsByType ( "player" ) ) do
		if ( p ~= localPlayer ) then
			local x, y, z = getElementPosition ( p )
			table.insert(WayPointLocs.Players,{getPlayerName(p),x,y,z})
		end
	end 
end

function appFunctions.waypoints:addWaypoint ( )
	local name = guiGetText ( pages['waypoints'].add_name )
	if ( name:gsub ( " ", "" ) == "" ) then
		return exports.NGMessages:sendClientMessage ( "Invalid name", 255, 255, 0 )
	elseif ( appFunctions.waypoints:waypointExists ( name ) ) then
		return exports.NGMessages:sendClientMessage ( "Yek waypoint ba in esm az ghabl vojod darad", 255, 255 ,0 )
	end
	
	local x, y, z = getElementPosition ( localPlayer ) 
	table.insert ( WayPointLocs.Custom, { name, x, y, z } )
	updateSetting ( "user_waypoints", toJSON ( WayPointLocs.Custom ) )
	exports.NGMessages:sendClientMessage ( "Shoma '"..tostring(name).."' ra be waypoints ezafe kardid!", 0, 255, 0 )
	appFunctions.waypoints:onPanelLoad ( )
	guiSetText ( pages['waypoints'].add_name, '' )
end

function appFunctions.waypoints:waypointExists ( n )
	local n = tostring ( n ):lower ( )
	for i, v in pairs ( WayPointLocs.Custom ) do
		if ( tostring ( v[1] ):lower ( ) == n ) then
			return true
		end
	end
	return false
end
